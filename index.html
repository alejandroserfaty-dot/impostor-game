<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="El Impostor">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Juego de party para descubrir al impostor">
    
    <title>El Impostor - Juego</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            touch-action: manipulation;
        }

        .category-btn:active {
            transform: scale(0.95);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #333;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .players-list {
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .player-item {
            background: #f5f5f5;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            touch-action: manipulation;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .player-turn {
            text-align: center;
            margin: 30px 0;
        }

        .player-name-display {
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        .word-reveal {
            background: #f8f9fa;
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-text {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
        }

        .word-text.impostor {
            color: #ff4757;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .results {
            margin: 30px 0;
        }

        .impostor-reveal {
            background: linear-gradient(135deg, #ff4757 0%, #ff6b6b 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .impostor-reveal span {
            display: block;
            font-size: 1.5em;
            margin-top: 10px;
        }

        .word-reveal-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
        }

        .word-reveal-box span {
            display: block;
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
            margin-top: 10px;
        }

        /* Install prompt */
        .install-prompt {
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .install-prompt.show {
            display: flex;
        }

        .install-prompt button {
            background: white;
            color: #4CAF50;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-left: auto;
        }

        /* Game mode toggle */
        .game-mode-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
        }

        .toggle-label {
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .mode-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .word-text {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Install prompt -->
        <div id="installPrompt" class="install-prompt">
            <span>üì± Instal√° la app en tu celular</span>
            <button onclick="installApp()">Instalar</button>
        </div>

        <!-- Pantalla de inicio -->
        <div id="homeScreen" class="screen active">
            <h1>üé≠ EL IMPOSTOR</h1>
            <p class="subtitle">Juego de party para descubrir al impostor</p>
            
            <div class="input-group">
                <label>Agregar Jugador</label>
                <input type="text" id="playerNameHome" placeholder="Nombre del jugador" 
                       onkeypress="if(event.key==='Enter') addPlayerHome()">
            </div>
            
            <button class="btn btn-primary" onclick="addPlayerHome()">+ Agregar Jugador</button>
            
            <div class="players-list" id="playersListHome"></div>
            
            <div class="warning-box" id="minPlayersWarningHome">
                ‚ö†Ô∏è Se necesitan al menos 3 jugadores para comenzar
            </div>
            
            <button class="btn btn-success" id="continueToCategories" 
                    style="display: none;" onclick="goToCategories()">
                Continuar ‚Üí
            </button>
        </div>

        <!-- Pantalla de categor√≠as -->
        <div id="categoriesScreen" class="screen">
            <h1>üé≠ EL IMPOSTOR</h1>
            <h2>Eleg√≠ una categor√≠a</h2>
            
            <div class="info-box">
                <span id="playersCount"></span> listos para jugar
            </div>
            
            <div class="category-grid">
                <button class="category-btn" onclick="selectCategory('futbol')">
                    ‚öΩ Futbolistas
                </button>
                <button class="category-btn" onclick="selectCategory('actores')">
                    üé≠ Actores
                </button>
                <button class="category-btn" onclick="selectCategory('peliculas')">
                    üé¨ Pel√≠culas
                </button>
                <button class="category-btn" onclick="selectCategory('comidas')">
                    üçï Comidas
                </button>
                <button class="category-btn" onclick="selectCategory('animales')">
                    ü¶Å Animales
                </button>
                <button class="category-btn" onclick="selectCategory('profesiones')">
                    üë®‚Äç‚öïÔ∏è Profesiones
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="goBack('homeScreen')">‚Üê Volver</button>
        </div>

        <!-- Pantalla de confirmaci√≥n -->
        <div id="readyScreen" class="screen">
            <h1>üé≠ EL IMPOSTOR</h1>
            <h2>¬°Listo para comenzar!</h2>
            
            <div class="info-box">
                Categor√≠a seleccionada: <strong id="selectedCategoryReady"></strong>
            </div>
            
            <!-- Modo de juego -->
            <div class="game-mode-box" id="gameModeBox">
                <div style="font-weight: 600; color: #333; margin-bottom: 10px;">
                    ‚öôÔ∏è Modo de Juego
                </div>
                <div class="toggle-container">
                    <div>
                        <div class="toggle-label">
                            üç∫ Jugar con Borracho
                        </div>
                        <div class="mode-description" id="modeDescription">
                            Un jugador ver√° una palabra similar
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="drunkModeToggle" onchange="updateModeDescription()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="warning-box">
                ‚ö†Ô∏è Asegurate de que todos los jugadores est√©n listos. 
                Cada uno ver√° su palabra en secreto, ¬°no esp√≠en!
            </div>
            
            <button class="btn btn-success" onclick="startGame()">üéÆ Comenzar Juego</button>
            <button class="btn btn-secondary" onclick="goBack('categoriesScreen')">‚Üê Volver</button>
        </div>

        <!-- Pantalla de turno -->
        <div id="turnScreen" class="screen">
            <h1>üé≠ EL IMPOSTOR</h1>
            
            <div class="player-turn">
                <h2>Turno de:</h2>
                <div class="player-name-display" id="currentPlayerName"></div>
            </div>
            
            <div class="warning-box">
                ‚ö†Ô∏è <strong id="currentPlayerNameWarning"></strong>, preparate para ver tu palabra. 
                ¬°Los dem√°s no deben mirar la pantalla!
            </div>
            
            <button class="btn btn-primary" onclick="revealWord()">üëÅÔ∏è Ver mi palabra</button>
        </div>

        <!-- Pantalla de revelaci√≥n -->
        <div id="revealScreen" class="screen">
            <div class="player-turn">
                <h2>Tu palabra es:</h2>
            </div>
            
            <div class="word-reveal">
                <div class="word-text" id="revealedWord"></div>
            </div>
            
            <div class="info-box">
                üí° Memoriz√° tu palabra y pas√° el celular al siguiente jugador
            </div>
            
            <button class="btn btn-primary" onclick="nextPlayer()">Siguiente Jugador ‚Üí</button>
        </div>

        <!-- Pantalla de resultados -->
        <div id="resultsScreen" class="screen">
            <h1>üé≠ EL IMPOSTOR</h1>
            <h2>¬°Todos los jugadores vieron su palabra!</h2>
            
            <div class="info-box">
                üí¨ Ahora discutan entre todos para descubrir qui√©n es el impostor
            </div>
            
            <div class="warning-box">
                ‚ö†Ô∏è Cuando est√©n listos, presion√° el bot√≥n para revelar qui√©n era el impostor
            </div>
            
            <button class="btn btn-danger" onclick="showFinalReveal()">üé≠ Revelar el Impostor</button>
            <button class="btn btn-secondary" onclick="goBack('homeScreen')">‚Üê Inicio</button>
        </div>

        <!-- Pantalla de revelaci√≥n final -->
        <div id="finalRevealScreen" class="screen">
            <h1>üé≠ EL IMPOSTOR</h1>
            <h2>¬°Fin del Juego!</h2>
            
            <div class="results">
                <div class="impostor-reveal" id="impostorRevealContainer">
                    <!-- Se llenar√° din√°micamente con JavaScript -->
                </div>
                
                <div class="impostor-reveal" id="drunkRevealContainer" style="display: none; background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%); margin-top: 15px;">
                    <!-- Se llenar√° din√°micamente con JavaScript -->
                </div>
                
                <div class="word-reveal-box">
                    La palabra era: <span id="finalWord"></span>
                </div>
            </div>
            
            <button class="btn btn-success" onclick="restartGame()">üîÑ Jugar de nuevo</button>
            <button class="btn btn-secondary" onclick="goBack('homeScreen')">‚Üê Inicio</button>
        </div>
    </div>

    <script>
        // Categor√≠as predefinidas con palabras
        const categories = {
            futbol: ['Messi', 'Cristiano Ronaldo', 'Neymar', 'Mbapp√©', 'Haaland', 'Pel√©', 'Maradona', 'Ronaldinho', 'Benzema', 'Lewandowski', 'Zidane', 'Ronaldo Nazario', 'Iniesta', 'Xavi', 'Modric', 'Kroos', 'De Bruyne', 'Salah', 'Kane', 'Ag√ºero', 'Su√°rez', 'Griezmann', 'Pogba', 'Ramos', 'Van Dijk', 'Neuer', 'Buffon', 'Casillas', 'Drogba', 'Zlatan Ibrahimovic'],
            actores: ['Leonardo DiCaprio', 'Tom Hanks', 'Brad Pitt', 'Johnny Depp', 'Will Smith', 'Morgan Freeman', 'Robert Downey Jr', 'Tom Cruise', 'Denzel Washington', 'Samuel L. Jackson', 'Matt Damon', 'Christian Bale', 'Ryan Gosling', 'Ricardo Dar√≠n', 'Adam Sandler', 'Jim Carrey', 'Robin Williams', 'Al Pacino', 'Robert De Niro', 'Harrison Ford', 'Keanu Reeves', 'Nicolas Cage', 'George Clooney', 'Ben Affleck', 'Guillermo Francella', 'Dwayne Johnson', 'Chris Hemsworth', 'Chris Evans', 'Scarlett Johansson', 'Jennifer Lawrence'],
            peliculas: ['Titanic', 'Avatar', 'El Padrino', 'Matrix', 'Joker', 'Avengers', 'Toy Story', 'Interestelar', 'Gladiador', 'Pulp Fiction', 'El Caballero de la Noche', 'Forrest Gump', 'El Rey Le√≥n', 'Star Wars', 'Jurassic Park', 'Volver al Futuro', 'El Se√±or de los Anillos', 'Harry Potter', 'Spider-Man', 'Iron Man', 'Buscando a Nemo', 'Shrek', 'Los Incre√≠bles', 'Frozen', 'Coco', 'Parasite', 'La La Land', 'Mad Max', 'Blancanieves', 'Kill Bill'],
            comidas: ['Pizza', 'Hamburguesa', 'Sushi', 'Tacos', '√ëoquis', 'Asado', 'Empanadas', 'Milanesa', 'Paella', 'Ramen', 'Lasa√±a', 'Risotto', 'Curry', 'Suprema de Pollo', 'Locro', 'Falafel', 'Shawarma', 'Burrito', 'Quesadilla', 'Hot Dog', 'Chorip√°n', 'Ceviche', 'Pastel de Papas', 'Arepas', 'Churrasco', 'Feijoada', 'Guiso', 'Ensalada C√©sar', 'Ravioles', 'Tiramis√∫', 'Bu√±uelos de Acelga'],
            animales: ['Le√≥n', 'Elefante', 'Tigre', 'Jirafa', 'Delf√≠n', '√Åguila', 'Ping√ºino', 'Koala', 'Panda', 'Lobo', 'Oso', 'Gorila', 'Rinoceronte', 'Hipop√≥tamo', 'Cebra', 'Guepardo', 'Leopardo', 'Cocodrilo', 'Tibur√≥n', 'Ballena', 'Canguro', 'Oso Polar', 'Flamenco', 'B√∫ho', 'Serpiente', 'Tortuga', 'Camello', 'Pulpo', 'Medusa', 'Foca'],
            profesiones: ['M√©dico', 'Profesor', 'Ingeniero', 'Chef', 'Piloto', 'Bombero', 'Abogado', 'M√∫sico', 'Actor', 'Deportista', 'Arquitecto', 'Dentista', 'Enfermero', 'Polic√≠a', 'Veterinario', 'Periodista', 'Fot√≥grafo', 'Dise√±ador Gr√°fico', 'Programador', 'Electricista', 'Plomero', 'Mec√°nico', 'Contador', 'Psic√≥logo', 'Farmac√©utico', 'Escritor', 'Traductor', 'Cient√≠fico', 'Astronauta', 'Pol√≠tico']
        };

        // Palabras similares para el rol del Borracho
        const similarWords = {
            futbol: {
                'Messi': 'Maradona',
                'Cristiano Ronaldo': 'Messi',
                'Neymar': 'Mbapp√©',
                'Mbapp√©': 'Haaland',
                'Haaland': 'Mbapp√©',
                'Pel√©': 'Maradona',
                'Maradona': 'Pel√©',
                'Ronaldinho': 'Ronaldo Nazario',
                'Benzema': 'Lewandowski',
                'Lewandowski': 'Benzema',
                'Zidane': 'Iniesta',
                'Ronaldo Nazario': 'Ronaldinho',
                'Iniesta': 'Xavi',
                'Xavi': 'Modric',
                'Modric': 'Kroos',
                'Kroos': 'Modric',
                'De Bruyne': 'Modric',
                'Salah': 'Kane',
                'Kane': 'Ag√ºero',
                'Ag√ºero': 'Su√°rez',
                'Su√°rez': 'Griezmann',
                'Griezmann': 'Pogba',
                'Pogba': 'Griezmann',
                'Ramos': 'Van Dijk',
                'Van Dijk': 'Ramos',
                'Neuer': 'Buffon',
                'Buffon': 'Casillas',
                'Casillas': 'Neuer',
                'Drogba': 'Zlatan Ibrahimovic',
                'Zlatan Ibrahimovic': 'Drogba'
            },
            actores: {
                'Leonardo DiCaprio': 'Brad Pitt',
                'Tom Hanks': 'Tom Cruise',
                'Brad Pitt': 'Leonardo DiCaprio',
                'Johnny Depp': 'Nicolas Cage',
                'Will Smith': 'Denzel Washington',
                'Morgan Freeman': 'Samuel L. Jackson',
                'Robert Downey Jr': 'Chris Evans',
                'Tom Cruise': 'Tom Hanks',
                'Denzel Washington': 'Will Smith',
                'Samuel L. Jackson': 'Morgan Freeman',
                'Matt Damon': 'Ben Affleck',
                'Christian Bale': 'Ryan Gosling',
                'Ryan Gosling': 'Christian Bale',
                'Ricardo Dar√≠n': 'Guillermo Francella',
                'Adam Sandler': 'Jim Carrey',
                'Jim Carrey': 'Robin Williams',
                'Robin Williams': 'Jim Carrey',
                'Al Pacino': 'Robert De Niro',
                'Robert De Niro': 'Al Pacino',
                'Harrison Ford': 'Keanu Reeves',
                'Keanu Reeves': 'Harrison Ford',
                'Nicolas Cage': 'Johnny Depp',
                'George Clooney': 'Ben Affleck',
                'Ben Affleck': 'Matt Damon',
                'Guillermo Francella': 'Ricardo Dar√≠n',
                'Dwayne Johnson': 'Chris Hemsworth',
                'Chris Hemsworth': 'Chris Evans',
                'Chris Evans': 'Chris Hemsworth',
                'Scarlett Johansson': 'Jennifer Lawrence',
                'Jennifer Lawrence': 'Scarlett Johansson'
            },
            peliculas: {
                'Titanic': 'Avatar',
                'Avatar': 'Titanic',
                'El Padrino': 'Pulp Fiction',
                'Matrix': 'Kill Bill',
                'Joker': 'El Caballero de la Noche',
                'Avengers': 'Iron Man',
                'Toy Story': 'Buscando a Nemo',
                'Interestelar': 'Matrix',
                'Gladiador': 'Mad Max',
                'Pulp Fiction': 'El Padrino',
                'El Caballero de la Noche': 'Joker',
                'Forrest Gump': 'Volver al Futuro',
                'El Rey Le√≥n': 'Buscando a Nemo',
                'Star Wars': 'El Se√±or de los Anillos',
                'Jurassic Park': 'Avatar',
                'Volver al Futuro': 'Forrest Gump',
                'El Se√±or de los Anillos': 'Harry Potter',
                'Harry Potter': 'El Se√±or de los Anillos',
                'Spider-Man': 'Iron Man',
                'Iron Man': 'Spider-Man',
                'Buscando a Nemo': 'Toy Story',
                'Shrek': 'Los Incre√≠bles',
                'Los Incre√≠bles': 'Shrek',
                'Frozen': 'Coco',
                'Coco': 'Frozen',
                'Parasite': 'Joker',
                'La La Land': 'Coco',
                'Mad Max': 'Gladiador',
                'Blancanieves': 'Frozen',
                'Kill Bill': 'Matrix'
            },
            comidas: {
                'Pizza': 'Hamburguesa',
                'Hamburguesa': 'Hot Dog',
                'Sushi': 'Ramen',
                'Tacos': 'Burrito',
                '√ëoquis': 'Ravioles',
                'Asado': 'Churrasco',
                'Empanadas': 'Pastel de Papas',
                'Milanesa': 'Asado',
                'Paella': 'Risotto',
                'Ramen': 'Guiso',
                'Lasa√±a': 'Ravioles',
                'Risotto': 'Paella',
                'Curry': 'Locro',
                'Suprema de Pollo': 'Milanesa',
                'Locro': 'Guiso',
                'Falafel': 'Shawarma',
                'Shawarma': 'Chorip√°n',
                'Burrito': 'Quesadilla',
                'Quesadilla': 'Tacos',
                'Hot Dog': 'Hamburguesa',
                'Chorip√°n': 'Hot Dog',
                'Ceviche': 'Sushi',
                'Pastel de Papas': 'Empanadas',
                'Arepas': 'Empanadas',
                'Churrasco': 'Asado',
                'Feijoada': 'Churrasco',
                'Guiso': 'Ramen',
                'Ensalada C√©sar': 'Bu√±uelos de Acelga',
                'Ravioles': 'Lasa√±a',
                'Tiramis√∫': 'Risotto',
                'Bu√±uelos de Acelga': 'Ensalada C√©sar'
            },
            animales: {
                'Le√≥n': 'Tigre',
                'Elefante': 'Rinoceronte',
                'Tigre': 'Leopardo',
                'Jirafa': 'Elefante',
                'Delf√≠n': 'Ballena',
                '√Åguila': 'B√∫ho',
                'Ping√ºino': 'Foca',
                'Koala': 'Panda',
                'Panda': 'Koala',
                'Lobo': 'Oso',
                'Oso': 'Oso Polar',
                'Gorila': 'Chimpanc√©',
                'Rinoceronte': 'Hipop√≥tamo',
                'Hipop√≥tamo': 'Rinoceronte',
                'Cebra': 'Jirafa',
                'Guepardo': 'Leopardo',
                'Leopardo': 'Tigre',
                'Cocodrilo': 'Serpiente',
                'Tibur√≥n': 'Ballena',
                'Ballena': 'Delf√≠n',
                'Canguro': 'Koala',
                'Oso Polar': 'Ping√ºino',
                'Flamenco': '√Åguila',
                'B√∫ho': '√Åguila',
                'Serpiente': 'Cocodrilo',
                'Tortuga': 'Foca',
                'Camello': 'Jirafa',
                'Pulpo': 'Medusa',
                'Medusa': 'Pulpo',
                'Foca': 'Ping√ºino'
            },
            profesiones: {
                'M√©dico': 'Enfermero',
                'Profesor': 'Maestro',
                'Ingeniero': 'Arquitecto',
                'Chef': 'Cocinero',
                'Piloto': 'Astronauta',
                'Bombero': 'Polic√≠a',
                'Abogado': 'Juez',
                'M√∫sico': 'Cantante',
                'Actor': 'Director',
                'Deportista': 'Entrenador',
                'Arquitecto': 'Ingeniero',
                'Dentista': 'M√©dico',
                'Enfermero': 'M√©dico',
                'Polic√≠a': 'Bombero',
                'Veterinario': 'M√©dico',
                'Periodista': 'Escritor',
                'Fot√≥grafo': 'Artista',
                'Dise√±ador Gr√°fico': 'Arquitecto',
                'Programador': 'Ingeniero',
                'Electricista': 'Plomero',
                'Plomero': 'Mec√°nico',
                'Mec√°nico': 'Electricista',
                'Contador': 'Economista',
                'Psic√≥logo': 'Psiquiatra',
                'Farmac√©utico': 'M√©dico',
                'Escritor': 'Periodista',
                'Traductor': 'Profesor',
                'Cient√≠fico': 'Investigador',
                'Astronauta': 'Piloto',
                'Pol√≠tico': 'Senador'
            }
        };

        let gameState = {
            category: '',
            word: '',
            players: [],
            currentPlayerIndex: 0,
            impostorIndices: [], // Array para soportar m√∫ltiples impostores
            drunkIndex: -1, // √çndice del borracho
            drunkWord: '' // Palabra que ve el borracho
        };

        let deferredPrompt;

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('show');
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App instalada');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').classList.remove('show');
                });
            }
        }

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registrado'))
                .catch(err => console.log('Error al registrar Service Worker:', err));
        }

        function selectCategory(category) {
            gameState.category = category;
            const words = categories[category];
            gameState.word = words[Math.floor(Math.random() * words.length)];
            
            document.getElementById('selectedCategoryReady').textContent = getCategoryName(gameState.category);
            
            // Mostrar u ocultar el toggle del borracho seg√∫n cantidad de jugadores
            const gameModeBox = document.getElementById('gameModeBox');
            const drunkToggle = document.getElementById('drunkModeToggle');
            
            if (gameState.players.length > 6) {
                gameModeBox.style.display = 'block';
                drunkToggle.checked = true; // Por defecto activado si hay m√°s de 6
            } else {
                gameModeBox.style.display = 'none';
                drunkToggle.checked = false;
            }
            
            updateModeDescription();
            showScreen('readyScreen');
        }

        function updateModeDescription() {
            const drunkToggle = document.getElementById('drunkModeToggle');
            const description = document.getElementById('modeDescription');
            
            if (drunkToggle.checked) {
                description.textContent = 'Un jugador ver√° una palabra similar';
                description.style.color = '#ff9800';
            } else {
                description.textContent = 'Modo cl√°sico sin borracho';
                description.style.color = '#666';
            }
        }

        function addPlayerHome() {
            const input = document.getElementById('playerNameHome');
            const name = input.value.trim();
            
            if (!name) {
                alert('‚ö†Ô∏è Por favor ingres√° un nombre');
                return;
            }
            
            if (gameState.players.includes(name)) {
                alert('‚ö†Ô∏è Este jugador ya est√° en la lista');
                return;
            }
            
            gameState.players.push(name);
            input.value = '';
            updatePlayersListHome();
            input.focus();
        }

        function removePlayerHome(index) {
            gameState.players.splice(index, 1);
            updatePlayersListHome();
        }

        function updatePlayersListHome() {
            const list = document.getElementById('playersListHome');
            list.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'player-item';
                item.innerHTML = `
                    <span>${index + 1}. ${player}</span>
                    <button class="remove-btn" onclick="removePlayerHome(${index})">‚úï</button>
                `;
                list.appendChild(item);
            });
            
            const minWarning = document.getElementById('minPlayersWarningHome');
            const continueBtn = document.getElementById('continueToCategories');
            
            if (gameState.players.length >= 3) {
                minWarning.style.display = 'none';
                continueBtn.style.display = 'block';
            } else {
                minWarning.style.display = 'block';
                continueBtn.style.display = 'none';
            }
        }

        function goToCategories() {
            if (gameState.players.length < 3) {
                alert('‚ö†Ô∏è Se necesitan al menos 3 jugadores');
                return;
            }
            
            document.getElementById('playersCount').textContent = `${gameState.players.length} jugadores`;
            showScreen('categoriesScreen');
        }

        function getCategoryName(category) {
            const names = {
                futbol: '‚öΩ Futbolistas',
                actores: 'üé≠ Actores',
                peliculas: 'üé¨ Pel√≠culas',
                comidas: 'üçï Comidas',
                animales: 'ü¶Å Animales',
                profesiones: 'üë®‚Äç‚öïÔ∏è Profesiones'
            };
            return names[category] || category;
        }

        function shuffleArray(array) {
            // Fisher-Yates shuffle algorithm
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            if (gameState.players.length < 3) {
                alert('‚ö†Ô∏è Se necesitan al menos 3 jugadores');
                return;
            }
            
            // Mezclar el orden de los jugadores aleatoriamente
            gameState.players = shuffleArray([...gameState.players]);
            
            // Determinar la cantidad de impostores seg√∫n el n√∫mero de jugadores
            const numImpostors = gameState.players.length > 10 ? 2 : 1;
            
            // Seleccionar impostores aleatorios √∫nicos
            gameState.impostorIndices = [];
            while (gameState.impostorIndices.length < numImpostors) {
                const randomIndex = Math.floor(Math.random() * gameState.players.length);
                if (!gameState.impostorIndices.includes(randomIndex)) {
                    gameState.impostorIndices.push(randomIndex);
                }
            }
            
            // Seleccionar borracho si hay m√°s de 6 jugadores Y el modo est√° activado
            gameState.drunkIndex = -1;
            gameState.drunkWord = '';
            
            const drunkModeEnabled = document.getElementById('drunkModeToggle').checked;
            
            if (gameState.players.length > 6 && drunkModeEnabled) {
                // Seleccionar un jugador que NO sea impostor
                let availableIndices = [];
                for (let i = 0; i < gameState.players.length; i++) {
                    if (!gameState.impostorIndices.includes(i)) {
                        availableIndices.push(i);
                    }
                }
                
                gameState.drunkIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                
                // Asignar palabra similar
                const similarWordMap = similarWords[gameState.category];
                gameState.drunkWord = similarWordMap[gameState.word] || gameState.word;
            }
            
            gameState.currentPlayerIndex = 0;
            
            showPlayerTurn();
        }

        function showPlayerTurn() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            document.getElementById('currentPlayerName').textContent = currentPlayer;
            document.getElementById('currentPlayerNameWarning').textContent = currentPlayer;
            showScreen('turnScreen');
        }

        function revealWord() {
            const wordElement = document.getElementById('revealedWord');
            const isImpostor = gameState.impostorIndices.includes(gameState.currentPlayerIndex);
            const isDrunk = gameState.currentPlayerIndex === gameState.drunkIndex;
            
            if (isImpostor) {
                wordElement.textContent = 'üé≠ IMPOSTOR';
                wordElement.className = 'word-text impostor';
            } else if (isDrunk) {
                wordElement.textContent = gameState.drunkWord;
                wordElement.className = 'word-text';
            } else {
                wordElement.textContent = gameState.word;
                wordElement.className = 'word-text';
            }
            
            showScreen('revealScreen');
        }

        function nextPlayer() {
            gameState.currentPlayerIndex++;
            
            if (gameState.currentPlayerIndex >= gameState.players.length) {
                showResults();
            } else {
                showPlayerTurn();
            }
        }

        function showResults() {
            showScreen('resultsScreen');
        }

        function showFinalReveal() {
            const container = document.getElementById('impostorRevealContainer');
            
            if (gameState.impostorIndices.length === 1) {
                // Un solo impostor
                container.innerHTML = `üé≠ El impostor era: <span>${gameState.players[gameState.impostorIndices[0]]}</span>`;
            } else {
                // M√∫ltiples impostores
                const impostorNames = gameState.impostorIndices
                    .map(index => gameState.players[index])
                    .join(' y ');
                container.innerHTML = `üé≠ Los impostores eran: <span>${impostorNames}</span>`;
            }
            
            // Mostrar borracho si existe
            const drunkContainer = document.getElementById('drunkRevealContainer');
            if (gameState.drunkIndex >= 0) {
                drunkContainer.style.display = 'block';
                drunkContainer.innerHTML = `üç∫ El borracho era: <span>${gameState.players[gameState.drunkIndex]}</span><br><small>(Vio: "${gameState.drunkWord}")</small>`;
            } else {
                drunkContainer.style.display = 'none';
            }
            
            document.getElementById('finalWord').textContent = gameState.word;
            showScreen('finalRevealScreen');
        }

        function restartGame() {
            gameState.category = '';
            gameState.word = '';
            gameState.currentPlayerIndex = 0;
            gameState.impostorIndices = [];
            gameState.drunkIndex = -1;
            gameState.drunkWord = '';
            
            showScreen('categoriesScreen');
        }

        function goBack(screenId) {
            showScreen(screenId);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>
